(function(c,D){typeof exports=="object"&&typeof module<"u"?D(exports):typeof define=="function"&&define.amd?define(["exports"],D):(c=typeof globalThis<"u"?globalThis:c||self,D(c.Datastar={}))})(this,function(c){"use strict";function D(e,t){if(e)for(t(e),e=e.firstElementChild;e;)D(e,t),e=e.nextElementSibling}function W(e,t){e&&(t(e),e=e.parentElement,W(e,t))}function L(e){const t=`return ${e}`;return new Function("el","dataStack","actions",t)}function oe(e,t,n,s){const r=L(s);try{return r(e,t,n)}catch{console.error(`Error evaluating expression: ${s}`)}}function ie(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,n)=>n===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}function lt(e){console.warn("Overriding fetch with mock version, this should only be used in examples.");const t=async(n,s)=>{const r=new Request(n,s);if(!(n instanceof URL))throw new Error("url must be a URL");const o=e[n.pathname];if(!o)throw new Error(`No mock route found for ${r.url}`);const i=o[r.method];if(!i)throw new Error(`No mock route found for ${r.method} ${r.url}`);let{html:l,status:u,statusText:f,headers:a}=await i(r);return a||(a=new Headers),a.has("Content-Type")||a.append("Content-Type","text/html"),u=u||200,f=f||"OK",new Response(l,{status:u,statusText:f,headers:a})};window.fetch=t}let k,v=null,w=0,I=[],Z,J=!1;const F=0,ae=1,C=2;function X(e,t){const n=new le(e,t?.effect);return t?.equals&&(n.equals=t.equals),n}function ct(e,t){return e===t}class le{constructor(t,n=!1){this.isEffect=n,typeof t=="function"?(this.fn=t,this._value=void 0,this.isEffect=n||!1,this.state=C,n&&(I.push(this),Z?.(this))):(this.fn=void 0,this._value=t,this.state=F,this.isEffect=!1)}_value;fn;observers=null;sources=null;state;cleanups=[];equals=ct;get value(){return this.get()}set value(t){this.set(t)}get(){return k&&(!v&&k.sources&&k.sources[w]==this?w++:v?v.push(this):v=[this]),this.fn&&this.updateIfNecessary(),this._value}set(t){if(typeof t=="function"){const n=t;n!==this.fn&&this.stale(C),this.fn=n}else{this.fn&&(this.removeParentObservers(0),this.sources=null,this.fn=void 0);const n=t;if(!this.equals(this._value,n)){if(this.observers)for(let s=0;s<this.observers.length;s++)this.observers[s].stale(C);this._value=n}}}stale(t){if(this.state<t&&(this.state===F&&this.isEffect&&(I.push(this),Z?.(this)),this.state=t,this.observers))for(let n=0;n<this.observers.length;n++)this.observers[n].stale(ae)}update(){const t=this._value,n=k,s=v,r=w;k=this,v=null,w=0;try{if(this.cleanups.length&&(this.cleanups.forEach(o=>o(this._value)),this.cleanups=[]),this._value=this.fn(),v){if(this.removeParentObservers(w),this.sources&&w>0){this.sources.length=w+v.length;for(let o=0;o<v.length;o++)this.sources[w+o]=v[o]}else this.sources=v;for(let o=w;o<this.sources.length;o++){const i=this.sources[o];i.observers?i.observers.push(this):i.observers=[this]}}else this.sources&&w<this.sources.length&&(this.removeParentObservers(w),this.sources.length=w)}finally{v=s,k=n,w=r}if(!this.equals(t,this._value)&&this.observers)for(let o=0;o<this.observers.length;o++){const i=this.observers[o];i.state=C}this.state=F}updateIfNecessary(){if(this.state===ae){for(const t of this.sources)if(t.updateIfNecessary(),this.state===C)break}this.state===C&&this.update(),this.state=F}removeParentObservers(t){if(this.sources)for(let n=t;n<this.sources.length;n++){const s=this.sources[n],r=s.observers.findIndex(o=>o===this);s.observers[r]=s.observers[s.observers.length-1],s.observers.pop()}}}function ut(e){k?k.cleanups.push(e):console.error("onCleanup must be called from within a @reactive function")}function ft(){for(let e=0;e<I.length;e++)I[e].get();I.length=0}function dt(e=ht){Z=e}function ht(){J||(J=!0,queueMicrotask(()=>{J=!1,ft()}))}dt();function pt(e){return X(e)}function gt(e){return X(e)}function mt(e){return X(e,{effect:!0})}new MutationObserver(e=>{for(const t of e)t.removedNodes.forEach(n=>{const s=n;s&&G.delete(s)})}).observe(document,{attributes:!0,childList:!0,subtree:!0});function ce({regexp:e,replacer:t},n){const s=[...n.matchAll(e)];if(!s.length)return n;for(const r of s){if(!r.groups)continue;const{groups:o}=r,{whole:i}=o;n=n.replace(i,t(o))}return n}const _=new Map,K=new Map,G=new Map,ue=new Array,Y=new Map;function Et(e){D(e,t=>{G.delete(t)}),K.forEach((t,n)=>{console.log(`apply ${n} to ${e.id||e.tagName} `),t(e)})}const Q={};function b(e,t){if(e.toLowerCase()!==e)throw Error(`Data plugin 'data-${e}' must be lowercase`);if(_.has(e))throw new Error(`Data plugin 'data-${e}' already registered`);const n=e;_.set(e,n),t||(t={});for(const l of t.requiredPlugins||[])if(l===e)throw new Error(`Data plugin 'data-${e}' cannot require itself`);const s=new Set(_.keys());for(const l of t.requiredPlugins||[])if(!s.has(l))throw new Error(`Data plugin 'data-${e}' requires 'data-${l}'`);typeof t?.isPreprocessGlobal>"u"&&(t.isPreprocessGlobal=!0),t?.preprocessExpressions&&t.isPreprocessGlobal&&ue.push(...t.preprocessExpressions);const r=[];if(t?.allowedModifiers)for(const l of t.allowedModifiers){const u=l instanceof RegExp?l:new RegExp(l);r.push(u)}const o=new Set([...t?.allowedTags||[]].map(l=>l.toLowerCase()));function i(l){D(l,u=>{const f=$(u);if(!f)return;let a=G.get(f);if(a||(a=new Set,G.set(f,a)),!a.has(n)){if(a.add(n),o.size){const m=f.tagName.toLowerCase();if(!o.has(m))return}for(var d in f.dataset){if(!d.startsWith(e))continue;let[m,...g]=d.split(".");const p=e.length,S=p+1;m=m.slice(p,S).toLocaleLowerCase()+m.slice(S);const T=g.map(E=>{const[h,...R]=E.split(":");if(!r.some(at=>at.test(h)))throw new Error(`Modifier ${h} is not allowed for ${m}`);return{label:h,args:R}}),M=wt(f);let A=f.dataset[d]||"";for(const E of ue)A=ce(E,A);if(t?.preprocessExpressions&&!t?.isPreprocessGlobal)for(const E of t.preprocessExpressions)A=ce(E,A);const P=Y.get(f)||{};if(t?.withExpression){const E=t.withExpression({name:m,expression:A,el:f,dataStack:M,reactivity:{signal:pt,computed:gt,effect:mt,onCleanup:ut},withMod:h=>bt(T,h),hasMod:h=>vt(T,h),applyPlugins:h=>K.forEach(R=>R(h)),actions:Q});E&&Object.assign(P,E)}Y.set(f,P)}}})}i(document.body),K.set(n,i),console.info(`Registered data plugin: data-${e}`)}function wt(e){const t=[];W(e,s=>{const r=Y.get(s);r&&t.push(r)}),t.reverse();const n={};for(const s of t)for(const r in s)n[r]||(n[r]={}),Object.assign(n[r],s[r]);return n}function $(e){return e instanceof HTMLElement||e instanceof SVGElement?e:null}function vt(e,t){return e.some(n=>n.label===t)}function bt(e,t){return e.find(n=>n.label===t)}function yt(e){const{name:t,fn:n,requiredPlugins:s}=e,r=[x,...s||[]];if(t!=ie(t))throw new Error("must be camelCase");for(const o of r){if(!_.has(o))throw new Error(`requires '@${t}' registration`);if(t in Q)throw new Error(`'@${t}' already registered`);Q[t]=n}}let St=0;function Tt(){return St++}const x="action";function Pt(){b(x,{preprocessExpressions:[{name:"action",description:"turns @action(args) into actions.action(args)",regexp:new RegExp(/(?<whole>@(?<action>[a-zA-Z_$][0-9a-zA-Z_$]*)(?<call>\((?<args>.*)\))?)/g),replacer:({action:e,args:t})=>`actions.${e}({el,dataStack, actions}, ${t||""})`}]})}const fe="bind";function de(){b(fe,{requiredPlugins:[y],withExpression:({el:e,name:t,expression:n,dataStack:s,actions:r,reactivity:{effect:o}})=>{const i=L(n);return{bind:{[t]:o(()=>{if(!s?.signals)return;const u=i(e,s,r);e.setAttribute(t,`${u}`)})}}}})}const he="focus";function pe(){b(he,{requiredPlugins:[y],withExpression:({el:e})=>{const t=$(e);if(!t?.focus)throw new Error("Element must have a focus method");return t.focus(),{}}})}const z=new WeakSet;function Mt(e,t,n={}){e instanceof Document&&(e=e.documentElement);let s;typeof t=="string"?s=Nt(t):s=t;const r=Rt(s),o=Dt(e,r,n);return ge(e,r,o)}function ge(e,t,n){if(n.head.block){const s=e.querySelector("head"),r=t.querySelector("head");if(s&&r){const o=Ee(r,s,n);Promise.all(o).then(()=>{ge(e,t,Object.assign(n,{head:{block:!1,ignore:!0}}))});return}}if(n.morphStyle==="innerHTML")return me(t,e,n),e.children;if(n.morphStyle==="outerHTML"||n.morphStyle==null){const s=Ct(t,e,n);if(!s)throw new Error("Could not find best match");const r=s?.previousSibling,o=s?.nextSibling,i=B(e,s,n);return s?Ot(r,i,o):[]}else throw"Do not understand how to morph style "+n.morphStyle}function B(e,t,n){if(!(n.ignoreActive&&e===document.activeElement))if(t==null){if(n.callbacks.beforeNodeRemoved(e)===!1)return;e.remove(),n.callbacks.afterNodeRemoved(e);return}else{if(j(e,t))return n.callbacks.beforeNodeMorphed(e,t)===!1?void 0:(e instanceof HTMLHeadElement&&n.head.ignore||(t instanceof HTMLHeadElement&&e instanceof HTMLHeadElement&&n.head.style!=="morph"?Ee(t,e,n):(At(t,e),me(t,e,n))),n.callbacks.afterNodeMorphed(e,t),e);if(n.callbacks.beforeNodeRemoved(e)===!1||n.callbacks.beforeNodeAdded(t)===!1)return;if(!e.parentElement)throw new Error("oldNode has no parentElement");return e.parentElement.replaceChild(t,e),n.callbacks.afterNodeAdded(t),n.callbacks.afterNodeRemoved(e),t}}function me(e,t,n){let s=e.firstChild,r=t.firstChild,o;for(;s;){if(o=s,s=o.nextSibling,r==null){if(n.callbacks.beforeNodeAdded(o)===!1)return;t.appendChild(o),n.callbacks.afterNodeAdded(o),O(n,o);continue}if(we(o,r,n)){B(r,o,n),r=r.nextSibling,O(n,o);continue}let i=Lt(e,t,o,r,n);if(i){r=ve(r,i,n),B(i,o,n),O(n,o);continue}let l=kt(e,o,r,n);if(l){r=ve(r,l,n),B(l,o,n),O(n,o);continue}if(n.callbacks.beforeNodeAdded(o)===!1)return;t.insertBefore(o,r),n.callbacks.afterNodeAdded(o),O(n,o)}for(;r!==null;){let i=r;r=r.nextSibling,ye(i,n)}}function At(e,t){let n=e.nodeType;if(n===1){for(const s of e.attributes)t.getAttribute(s.name)!==s.value&&t.setAttribute(s.name,s.value);for(const s of t.attributes)e.hasAttribute(s.name)||t.removeAttribute(s.name)}if((n===Node.COMMENT_NODE||n===Node.TEXT_NODE)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),e instanceof HTMLInputElement&&t instanceof HTMLInputElement&&e.type!=="file")t.value=e.value||"",U(e,t,"value"),U(e,t,"checked"),U(e,t,"disabled");else if(e instanceof HTMLOptionElement)U(e,t,"selected");else if(e instanceof HTMLTextAreaElement&&t instanceof HTMLTextAreaElement){const s=e.value,r=t.value;s!==r&&(t.value=s),t.firstChild&&t.firstChild.nodeValue!==s&&(t.firstChild.nodeValue=s)}}function U(e,t,n){const s=e.getAttribute(n),r=t.getAttribute(n);s!==r&&(s?t.setAttribute(n,s):t.removeAttribute(n))}function Ee(e,t,n){const s=[],r=[],o=[],i=[],l=n.head.style,u=new Map;for(const a of e.children)u.set(a.outerHTML,a);for(const a of t.children){let d=u.has(a.outerHTML),m=n.head.shouldReAppend(a),g=n.head.shouldPreserve(a);d||g?m?r.push(a):(u.delete(a.outerHTML),o.push(a)):l==="append"?m&&(r.push(a),i.push(a)):n.head.shouldRemove(a)!==!1&&r.push(a)}i.push(...u.values()),console.log("to append: ",i);const f=[];for(const a of i){console.log("adding: ",a);const d=document.createRange().createContextualFragment(a.outerHTML).firstChild;if(!d)throw new Error("could not create new element from: "+a.outerHTML);if(console.log(d),n.callbacks.beforeNodeAdded(d)){if(d.hasAttribute("href")||d.hasAttribute("src")){let m;const g=new Promise(p=>{m=p});d.addEventListener("load",function(){m(void 0)}),f.push(g)}t.appendChild(d),n.callbacks.afterNodeAdded(d),s.push(d)}}for(const a of r)n.callbacks.beforeNodeRemoved(a)!==!1&&(t.removeChild(a),n.callbacks.afterNodeRemoved(a));return n.head.afterHeadMorphed(t,{added:s,kept:o,removed:r}),f}function N(){}function Dt(e,t,n){return{target:e,newContent:t,config:n,morphStyle:n.morphStyle,ignoreActive:n.ignoreActive,idMap:qt(e,t),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:N,afterNodeAdded:N,beforeNodeMorphed:N,afterNodeMorphed:N,beforeNodeRemoved:N,afterNodeRemoved:N},n.callbacks),head:Object.assign({style:"merge",shouldPreserve:s=>s.getAttribute("im-preserve")==="true",shouldReAppend:s=>s.getAttribute("im-re-append")==="true",shouldRemove:N,afterHeadMorphed:N},n.head)}}function we(e,t,n){return!e||!t?!1:e.nodeType===t.nodeType&&e.tagName===t.tagName?e?.id?.length&&e.id===t.id?!0:H(n,e,t)>0:!1}function j(e,t){return!e||!t?!1:e.nodeType===t.nodeType&&e.tagName===t.tagName}function ve(e,t,n){for(;e!==t;){const s=e;if(e=e?.nextSibling,!s)throw new Error("tempNode is null");ye(s,n)}return O(n,t),t.nextSibling}function Lt(e,t,n,s,r){const o=H(r,n,t);let i=null;if(o>0){i=s;let l=0;for(;i!=null;){if(we(n,i,r))return i;if(l+=H(r,i,e),l>o)return null;i=i.nextSibling}}return i}function kt(e,t,n,s){let r=n,o=t.nextSibling,i=0;for(;r&&o;){if(H(s,r,e)>0)return null;if(j(t,r))return r;if(j(o,r)&&(i++,o=o.nextSibling,i>=2))return null;r=r.nextSibling}return r}const be=new DOMParser;function Nt(e){const t=e.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(t.match(/<\/html>/)||t.match(/<\/head>/)||t.match(/<\/body>/)){const n=be.parseFromString(e,"text/html");if(t.match(/<\/html>/))return z.add(n),n;{let s=n.firstChild;return s?(z.add(s),s):null}}else{const s=be.parseFromString(`<body><template>${e}</template></body>`,"text/html").body.querySelector("template")?.content;if(!s)throw new Error("content is null");return z.add(s),s}}function Rt(e){if(e==null)return document.createElement("div");if(z.has(e))return e;if(e instanceof Node){const t=document.createElement("div");return t.append(e),t}else{const t=document.createElement("div");for(const n of[...e])t.append(n);return t}}function Ot(e,t,n){const s=[],r=[];for(;e;)s.push(e),e=e.previousSibling;for(;s.length>0;){const o=s.pop();r.push(o),t?.parentElement?.insertBefore(o,t)}for(r.push(t);n;)s.push(n),r.push(n),n=n.nextSibling;for(;s.length;)t?.parentElement?.insertBefore(s.pop(),t.nextSibling);return r}function Ct(e,t,n){let s=e.firstChild,r=s,o=0;for(;s;){let i=It(s,t,n);i>o&&(r=s,o=i),s=s.nextSibling}return r}function It(e,t,n){return j(e,t)?.5+H(n,e,t):0}function ye(e,t){O(t,e),t.callbacks.beforeNodeRemoved(e)!==!1&&(e.remove(),t.callbacks.afterNodeRemoved(e))}function $t(e,t){return!e.deadIds.has(t)}function Ht(e,t,n){return e.idMap.get(n)?.has(t)||!1}function O(e,t){const n=e.idMap.get(t);if(n)for(const s of n)e.deadIds.add(s)}function H(e,t,n){const s=e.idMap.get(t);if(!s)return 0;let r=0;for(const o of s)$t(e,o)&&Ht(e,o,n)&&++r;return r}function Se(e,t){const n=e.parentElement,s=e.querySelectorAll("[id]");for(const r of s){let o=r;for(;o!==n&&o;){let i=t.get(o);i==null&&(i=new Set,t.set(o,i)),i.add(r.id),o=o.parentElement}}}function qt(e,t){const n=new Map;return Se(e,n),Se(t,n),n}const Ft=new DOMParser,Te="datastar",ee=`${Te}-indicator`,V=`${Te}-request`,_t="Accept",Pe="text/html",Gt="Content-Type",zt="application/json",Bt="selector",Ut="swap",te="get",Me=()=>q(te),Ae="post",De=()=>q(Ae),Le="put",ke=()=>q(Le),Ne="patch",Re=()=>q(Ne),Oe="delete",Ce=()=>q(Oe),Ie=()=>{Me(),De(),ke(),Re(),Ce()};let $e=!1;function q(e){if(!$e){const t=document.createElement("style");t.innerHTML=`
.${ee}{
  opacity:0;
  transition: opacity 500ms ease-in;
}
.${V} .${ee}{
    opacity:1
}
.${V}.${ee}{
    opacity:1
}
    `,document.head.appendChild(t),$e=!0}yt({name:e,description:`turns @${e}(args) into fetch(${e}, args)`,fn:async t=>jt(e,t)})}async function jt(e,t){const{el:n,dataStack:s}=t,r=s.signals?.[e];if(!r)throw new Error(`No signal for ${e}`);const o=$(n);if(!o)throw new Error("Element must be an HTMLElement or SVGElement");o.classList.add(V);const i=new URL(r.value,window.location.origin),l=new Headers;if(l.append(_t,Pe),l.append(Gt,zt),s?.headers)for(let g in s.headers){const p=s.headers[g];l.append(g,p.value)}const u=JSON.stringify(s,(g,p)=>p instanceof le?p.isEffect?void 0:p.get():p),f={method:e,headers:l};if(e===te){const g=new URLSearchParams(i.search);g.append("dataStack",u),i.search=g.toString()}else f.body=u;const a=await fetch(i,f);if(!a.ok)throw new Error("Network response was not ok.");const d=await a.text(),m=[...Ft.parseFromString(d,Pe).body.children];for(let g=0;g<m.length;g++){const p=m[g];if(!(p instanceof Element))throw new Error("Not an element");const S=$(p),T=p.getAttribute("id"),M=g===0,A=!!T?.length,P=M&&!A;let E;if(P)E=[n];else{if(!A)throw new Error("No id");const h=S?.dataset?.[Bt]||`#${T}`;E=document.querySelectorAll(h)||[]}if(!E)throw new Error("No target element");for(const h of E){switch(S?.dataset?.[Ut]||"morph"){case"morph":Mt(h,p);break;case"inner":h.innerHTML=p.innerHTML;break;case"outer":h.outerHTML=p.outerHTML;break;case"prepend":h.prepend(p.outerHTML);break;case"append":h.append(p.outerHTML);break;case"before":h.before(p);break;case"after":h.after(p);break;case"delete":h.remove();break;default:throw new Error("Invalid merge mode")}Et(h)}}o.classList.remove(V)}const Vt="model",He=["change","input","keydown"];function Wt(){b(Vt,{allowedTags:["input","textarea","select"],requiredPlugins:[y],withExpression:({name:e,el:t,expression:n,dataStack:s,reactivity:{effect:r,onCleanup:o}})=>{const i=s.signals[n];if(!i)throw new Error(`Signal ${n} not found`);if(!("value"in t))throw new Error("Element must have a value property");t.value=i.value;const l=()=>{const u=i.value;if(typeof u=="number")i.value=Number(t.value);else if(typeof u=="string")i.value=t.value;else if(typeof u=="boolean")i.value=!!t.value;else throw new Error("Unsupported type")};return{model:{[`${e}-${Tt()}`]:r(()=>{t.value=i.value;for(const u of He)t.addEventListener(u,l);o(()=>{for(const u of He)t.removeEventListener(u,l)})})}}}})}const qe="on",Fe="once",_e="throttle",Ge="debounce",ze="leading";function Be(){b(qe,{requiredPlugins:[y],allowedModifiers:[Fe,_e,Ge,ze],withExpression:({el:e,name:t,hasMod:n,withMod:s,expression:r,dataStack:o,reactivity:{computed:i,effect:l,onCleanup:u},actions:f})=>{const a=L(r),d=n(Fe),m=s(_e),g=s(Ge),p=n(ze);if(t==="load"){document.addEventListener("DOMContentLoaded",()=>a(e,o,f),!0);return}const S=()=>a(e,o,f);let T=S,M;if(d)T=()=>{S(),M&&e.removeEventListener(t,M)};else if(m){const[P]=m.args,E=P?Number(P):1e3;let h=0;const R=i(()=>{const re=Date.now();if(re-h>=E)return h=re,S()});T=()=>R.value}else if(g){const[P]=g.args,E=P?Number(P):1e3;let h;const R=i(()=>{p&&!h&&S(),clearTimeout(h),h=setTimeout(()=>{p?h=void 0:S()},E)});T=()=>R.value}return M=()=>T(),e.addEventListener(t,M),{on:{[t]:l(()=>{u(()=>{d||e.removeEventListener(t,M)})})}}}})}const Ue="ref";function je(){b(Ue,{requiredPlugins:[y],preprocessExpressions:[{name:"ref",description:"turns #ref into data.refs.ref.value",regexp:new RegExp(/(?<whole>\#(?<ref>[a-zA-Z_$][0-9a-zA-Z_$]*))/g),replacer:({ref:e})=>`data.refs.${e}.value`}],withExpression:({el:e,name:t,reactivity:{signal:n}})=>({refs:{[t]:n(e)}})})}const ne="important",se="display",Ve="none",We="show";function Ze(){b(We,{requiredPlugins:[y],allowedModifiers:[ne],withExpression:({el:e,name:t,dataStack:n,expression:s,hasMod:r,reactivity:{effect:o},actions:i})=>{const l=L(s);if(!(e instanceof HTMLElement||e instanceof SVGElement))throw new Error("Element must have a style property");const f=r(ne)?ne:void 0;return{show:{[t]:o(()=>{!!l(e,n,i)?e.style.length===1&&e.style.display===Ve?e.style.removeProperty(se):e.style.setProperty(se,"",f):e.style.setProperty(se,Ve,f)})}}}})}const y="signal",Je="persist";function Xe(){b(y,{requiredPlugins:[x],preprocessExpressions:[{name:"signal",description:"turns $signal into dataStack.signals.signal.value",regexp:new RegExp(/(?<whole>\$(?<signal>[a-zA-Z_$][0-9a-zA-Z_$]*))/g),replacer:({signal:e})=>`dataStack.${y}s.${e}.value`}],allowedModifiers:[Je],withExpression:({name:e,el:t,expression:n,reactivity:s,hasMod:r,actions:o})=>{const i=s.signal(oe(t,{},o,n));if(r(Je)){const l=localStorage.getItem(e);if(l){const u=JSON.parse(l);i.value=u}s.effect(()=>{const u=JSON.stringify(i.value);localStorage.setItem(e,u)})}return{signals:{[e]:i}}}})}const Ke="prepend",Ye="append",Qe="Target element must have a parent if using prepend or append",xe="teleport";function et(){b(xe,{requiredPlugins:[y],allowedModifiers:[Ke,Ye],withExpression:({name:e,el:t,expression:n,dataStack:s,reactivity:{effect:r},hasMod:o,actions:i})=>{if(!(t instanceof HTMLTemplateElement))throw new Error("Element must be a template");const l=L(n);return{text:{[e]:r(()=>{const f=l(t,s,i);if(typeof f!="string")throw new Error("Selector must be a string");const a=document.querySelector(f);if(!a)throw new Error(`Target element not found: ${f}`);if(!t.content)throw new Error("Template element must have content");const d=t.content.cloneNode(!0);if($(d)?.firstElementChild)throw new Error("Empty template");if(o(Ke)){if(!a.parentNode)throw new Error(Qe);a.parentNode.insertBefore(d,a)}else if(o(Ye)){if(!a.parentNode)throw new Error(Qe);a.parentNode.insertBefore(d,a.nextSibling)}else a.appendChild(d);a.appendChild(d)})}}}})}const tt="text";function nt(){b(tt,{withExpression:({name:e,el:t,expression:n,dataStack:s,actions:r,reactivity:{effect:o}})=>{const i=L(n);return{text:{[e]:o(()=>{if(!s?.signals)return;const u=i(t,s,r);t.textContent=`${u}`})}}}})}const st="once",rt="full",ot="half",it="intersects";function Zt(){b(it,{requiredPlugins:[y],allowedModifiers:[st,rt,ot],withExpression:({name:e,el:t,expression:n,dataStack:s,actions:r,hasMod:o,reactivity:{effect:i,onCleanup:l}})=>{const u=L(n),f=()=>u(t,s,r),a={threshold:0};o(rt)?a.threshold=1:o(ot)&&(a.threshold=.5);const d=new IntersectionObserver(g=>{g.forEach(p=>{p.isIntersecting&&(f(),o(st)&&d.disconnect())})},a);return{on:{[e]:i(()=>{d.observe(t),l(()=>{d.disconnect()})})}}}})}function Jt(){Pt(),Xe(),de(),Wt(),pe(),Ie(),Be(),je(),Ze(),et(),nt()}c.BIND=fe,c.DELETE=Oe,c.FOCUS=he,c.GET=te,c.INTERSECTS=it,c.ON=qe,c.PATCH=Ne,c.POST=Ae,c.PUT=Le,c.REF=Ue,c.SHOW=We,c.SIGNAL=y,c.TELEPORT=xe,c.TEXT=tt,c.addAllFragmentPlugins=Ie,c.addAllIncludedPlugins=Jt,c.addBindDataPlugin=de,c.addDeletePlugin=Ce,c.addFocusDataPlugin=pe,c.addGetPlugin=Me,c.addIntersectsplugin=Zt,c.addOnDataPlugin=Be,c.addPatchPlugin=Re,c.addPostPlugin=De,c.addPutPlugin=ke,c.addRefDataPlugin=je,c.addShowDataPlugin=Ze,c.addSignalDataPlugin=Xe,c.addTeleportDataPlugin=et,c.addTextDataPlugin=nt,c.camelize=ie,c.functionEval=oe,c.functionGenerator=L,c.injectMockFetch=lt,c.walkDownDOM=D,c.walkUpDOM=W,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=datastar.umd.cjs.map
