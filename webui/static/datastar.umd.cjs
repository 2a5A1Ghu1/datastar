(function(u,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(u=typeof globalThis<"u"?globalThis:u||self,S(u.Datastar={}))})(this,function(u){"use strict";function S(e,t){if(e)for(t(e),e=e.firstElementChild;e;)S(e,t),e=e.nextElementSibling}function W(e,t){e&&(t(e),e=e.parentElement,W(e,t))}function T(e){const t=`return ${e}`;return new Function("el","dataStack","actions",t)}function oe(e,t,n,s){const r=T(s);try{return r(e,t,n)}catch{console.error(`Error evaluating expression: ${s}`)}}function ie(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,n)=>n===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}function ct(e){console.warn("Overriding fetch with mock version, this should only be used in examples.");const t=async(n,s)=>{const r=new Request(n,s);if(!(n instanceof URL))throw new Error("url must be a URL");const o=e[n.pathname];if(!o)throw new Error(`No mock route found for ${r.url}`);const i=o[r.method];if(!i)throw new Error(`No mock route found for ${r.method} ${r.url}`);let{html:l,status:f,statusText:d,headers:a}=await i(r);return a||(a=new Headers),a.has("Content-Type")||a.append("Content-Type","text/html"),f=f||200,d=d||"OK",new Response(l,{status:f,statusText:d,headers:a})};window.fetch=t}let P,E=null,m=0,I=[],Z,J=!1;const F=0,ae=1,O=2;function X(e,t){const n=new le(e,t?.effect);return t?.equals&&(n.equals=t.equals),n}function ut(e,t){return e===t}class le{constructor(t,n=!1){this.isEffect=n,typeof t=="function"?(this.fn=t,this._value=void 0,this.isEffect=n||!1,this.state=O,n&&(I.push(this),Z?.(this))):(this.fn=void 0,this._value=t,this.state=F,this.isEffect=!1)}_value;fn;observers=null;sources=null;state;cleanups=[];equals=ut;get value(){return this.get()}set value(t){this.set(t)}get(){return P&&(!E&&P.sources&&P.sources[m]==this?m++:E?E.push(this):E=[this]),this.fn&&this.updateIfNecessary(),this._value}set(t){if(typeof t=="function"){const n=t;n!==this.fn&&this.stale(O),this.fn=n}else{this.fn&&(this.removeParentObservers(0),this.sources=null,this.fn=void 0);const n=t;if(!this.equals(this._value,n)){if(this.observers)for(let s=0;s<this.observers.length;s++)this.observers[s].stale(O);this._value=n}}}stale(t){if(this.state<t&&(this.state===F&&this.isEffect&&(I.push(this),Z?.(this)),this.state=t,this.observers))for(let n=0;n<this.observers.length;n++)this.observers[n].stale(ae)}update(){const t=this._value,n=P,s=E,r=m;P=this,E=null,m=0;try{if(this.cleanups.length&&(this.cleanups.forEach(o=>o(this._value)),this.cleanups=[]),this._value=this.fn(),E){if(this.removeParentObservers(m),this.sources&&m>0){this.sources.length=m+E.length;for(let o=0;o<E.length;o++)this.sources[m+o]=E[o]}else this.sources=E;for(let o=m;o<this.sources.length;o++){const i=this.sources[o];i.observers?i.observers.push(this):i.observers=[this]}}else this.sources&&m<this.sources.length&&(this.removeParentObservers(m),this.sources.length=m)}finally{E=s,P=n,m=r}if(!this.equals(t,this._value)&&this.observers)for(let o=0;o<this.observers.length;o++){const i=this.observers[o];i.state=O}this.state=F}updateIfNecessary(){if(this.state===ae){for(const t of this.sources)if(t.updateIfNecessary(),this.state===O)break}this.state===O&&this.update(),this.state=F}removeParentObservers(t){if(this.sources)for(let n=t;n<this.sources.length;n++){const s=this.sources[n],r=s.observers.findIndex(o=>o===this);s.observers[r]=s.observers[s.observers.length-1],s.observers.pop()}}}function ft(e){P?P.cleanups.push(e):console.error("onCleanup must be called from within a @reactive function")}function dt(){for(let e=0;e<I.length;e++)I[e].get();I.length=0}function ht(e=pt){Z=e}function pt(){J||(J=!0,queueMicrotask(()=>{J=!1,dt()}))}ht();function gt(e){return X(e)}function mt(e){return X(e)}function Et(e){return X(e,{effect:!0})}new MutationObserver(e=>{for(const t of e)t.removedNodes.forEach(n=>{const s=n;s&&G.delete(s)})}).observe(document,{attributes:!0,childList:!0,subtree:!0});function ce({regexp:e,replacer:t},n){const s=[...n.matchAll(e)];if(!s.length)return n;for(const r of s){if(!r.groups)continue;const{groups:o}=r,{whole:i}=o;n=n.replace(i,t(o))}return n}const _=new Map,K=new Map,G=new Map,ue=new Array,Y=new Map;function wt(e){S(e,t=>{G.delete(t)}),K.forEach((t,n)=>{console.log(`apply ${n} to ${e.id||e.tagName} `),t(e)})}const Q={};function v(e,t){if(e.toLowerCase()!==e)throw Error(`Data plugin 'data-${e}' must be lowercase`);if(_.has(e))throw new Error(`Data plugin 'data-${e}' already registered`);const n=e;_.set(e,n),t||(t={});for(const l of t.requiredPlugins||[])if(l===e)throw new Error(`Data plugin 'data-${e}' cannot require itself`);const s=new Set(_.keys());for(const l of t.requiredPlugins||[])if(!s.has(l))throw new Error(`Data plugin 'data-${e}' requires 'data-${l}'`);typeof t?.isPreprocessGlobal>"u"&&(t.isPreprocessGlobal=!0),t?.preprocessExpressions&&t.isPreprocessGlobal&&ue.push(...t.preprocessExpressions);const r=[];if(t?.allowedModifiers)for(const l of t.allowedModifiers){const f=l instanceof RegExp?l:new RegExp(l);r.push(f)}const o=new Set([...t?.allowedTags||[]].map(l=>l.toLowerCase()));function i(l){S(l,f=>{const d=$(f);if(!d)return;let a=G.get(d);if(a||(a=new Set,G.set(d,a)),!a.has(n)){if(a.add(n),o.size){const h=d.tagName.toLowerCase();if(!o.has(h))return}for(var c in d.dataset){if(!c.startsWith(e))continue;let[h,...p]=c.split(".");const y=e.length,A=y+1;h=h.slice(y,A).toLocaleLowerCase()+h.slice(A);const k=p.map(w=>{const[g,...R]=w.split(":");if(!r.some(lt=>lt.test(g)))throw new Error(`Modifier ${g} is not allowed for ${h}`);return{label:g,args:R}}),N=vt(d);let C=d.dataset[c]||"";for(const w of ue)C=ce(w,C);if(t?.preprocessExpressions&&!t?.isPreprocessGlobal)for(const w of t.preprocessExpressions)C=ce(w,C);const D=Y.get(d)||{};if(t?.withExpression){const w=t.withExpression({name:h,expression:C,el:d,dataStack:N,reactivity:{signal:gt,computed:mt,effect:Et,onCleanup:ft},withMod:g=>yt(k,g),hasMod:g=>bt(k,g),applyPlugins:g=>K.forEach(R=>R(g)),actions:Q});w&&Object.assign(D,w)}Y.set(d,D)}}})}i(document.body),K.set(n,i),console.info(`Registered data plugin: data-${e}`)}function vt(e){const t=[];W(e,s=>{const r=Y.get(s);r&&t.push(r)}),t.reverse();const n={};for(const s of t)for(const r in s)n[r]||(n[r]={}),Object.assign(n[r],s[r]);return n}function $(e){return e instanceof HTMLElement||e instanceof SVGElement?e:null}function bt(e,t){return e.some(n=>n.label===t)}function yt(e,t){return e.find(n=>n.label===t)}function St(e){const{name:t,fn:n,requiredPlugins:s}=e,r=[x,...s||[]];if(t!=ie(t))throw new Error("must be camelCase");for(const o of r){if(!_.has(o))throw new Error(`requires '@${t}' registration`);if(t in Q)throw new Error(`'@${t}' already registered`);Q[t]=n}}let Tt=0;function Pt(){return Tt++}const x="action";function Mt(){v(x,{preprocessExpressions:[{name:"action",description:"turns @action(args) into actions.action(args)",regexp:new RegExp(/(?<whole>@(?<action>[a-zA-Z_$][0-9a-zA-Z_$]*)(?<call>\((?<args>.*)\))?)/g),replacer:({action:e,args:t})=>`actions.${e}({el,dataStack, actions}, ${t||""})`}]})}const fe="bind";function de(){v(fe,{requiredPlugins:[b],withExpression:({el:e,name:t,expression:n,dataStack:s,actions:r,reactivity:{effect:o}})=>{const i=T(n);return{bind:{[t]:o(()=>{if(!s?.signals)return;const f=i(e,s,r);e.setAttribute(t,`${f}`)})}}}})}const he="focus";function pe(){v(he,{requiredPlugins:[b],withExpression:({el:e})=>{const t=$(e);if(!t?.focus)throw new Error("Element must have a focus method");return t.focus(),{}}})}const z=new WeakSet;function At(e,t,n={}){e instanceof Document&&(e=e.documentElement);let s;typeof t=="string"?s=Rt(t):s=t;const r=Ot(s),o=Lt(e,r,n);return ge(e,r,o)}function ge(e,t,n){if(n.head.block){const s=e.querySelector("head"),r=t.querySelector("head");if(s&&r){const o=Ee(r,s,n);Promise.all(o).then(()=>{ge(e,t,Object.assign(n,{head:{block:!1,ignore:!0}}))});return}}if(n.morphStyle==="innerHTML")return me(t,e,n),e.children;if(n.morphStyle==="outerHTML"||n.morphStyle==null){const s=It(t,e,n);if(!s)throw new Error("Could not find best match");const r=s?.previousSibling,o=s?.nextSibling,i=B(e,s,n);return s?Ct(r,i,o):[]}else throw"Do not understand how to morph style "+n.morphStyle}function B(e,t,n){if(!(n.ignoreActive&&e===document.activeElement))if(t==null){if(n.callbacks.beforeNodeRemoved(e)===!1)return;e.remove(),n.callbacks.afterNodeRemoved(e);return}else{if(j(e,t))return n.callbacks.beforeNodeMorphed(e,t)===!1?void 0:(e instanceof HTMLHeadElement&&n.head.ignore||(t instanceof HTMLHeadElement&&e instanceof HTMLHeadElement&&n.head.style!=="morph"?Ee(t,e,n):(Dt(t,e),me(t,e,n))),n.callbacks.afterNodeMorphed(e,t),e);if(n.callbacks.beforeNodeRemoved(e)===!1||n.callbacks.beforeNodeAdded(t)===!1)return;if(!e.parentElement)throw new Error("oldNode has no parentElement");return e.parentElement.replaceChild(t,e),n.callbacks.afterNodeAdded(t),n.callbacks.afterNodeRemoved(e),t}}function me(e,t,n){let s=e.firstChild,r=t.firstChild,o;for(;s;){if(o=s,s=o.nextSibling,r==null){if(n.callbacks.beforeNodeAdded(o)===!1)return;t.appendChild(o),n.callbacks.afterNodeAdded(o),L(n,o);continue}if(we(o,r,n)){B(r,o,n),r=r.nextSibling,L(n,o);continue}let i=kt(e,t,o,r,n);if(i){r=ve(r,i,n),B(i,o,n),L(n,o);continue}let l=Nt(e,o,r,n);if(l){r=ve(r,l,n),B(l,o,n),L(n,o);continue}if(n.callbacks.beforeNodeAdded(o)===!1)return;t.insertBefore(o,r),n.callbacks.afterNodeAdded(o),L(n,o)}for(;r!==null;){let i=r;r=r.nextSibling,ye(i,n)}}function Dt(e,t){let n=e.nodeType;if(n===1){for(const s of e.attributes)t.getAttribute(s.name)!==s.value&&t.setAttribute(s.name,s.value);for(const s of t.attributes)e.hasAttribute(s.name)||t.removeAttribute(s.name)}if((n===Node.COMMENT_NODE||n===Node.TEXT_NODE)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),e instanceof HTMLInputElement&&t instanceof HTMLInputElement&&e.type!=="file")t.value=e.value||"",U(e,t,"value"),U(e,t,"checked"),U(e,t,"disabled");else if(e instanceof HTMLOptionElement)U(e,t,"selected");else if(e instanceof HTMLTextAreaElement&&t instanceof HTMLTextAreaElement){const s=e.value,r=t.value;s!==r&&(t.value=s),t.firstChild&&t.firstChild.nodeValue!==s&&(t.firstChild.nodeValue=s)}}function U(e,t,n){const s=e.getAttribute(n),r=t.getAttribute(n);s!==r&&(s?t.setAttribute(n,s):t.removeAttribute(n))}function Ee(e,t,n){const s=[],r=[],o=[],i=[],l=n.head.style,f=new Map;for(const a of e.children)f.set(a.outerHTML,a);for(const a of t.children){let c=f.has(a.outerHTML),h=n.head.shouldReAppend(a),p=n.head.shouldPreserve(a);c||p?h?r.push(a):(f.delete(a.outerHTML),o.push(a)):l==="append"?h&&(r.push(a),i.push(a)):n.head.shouldRemove(a)!==!1&&r.push(a)}i.push(...f.values()),console.log("to append: ",i);const d=[];for(const a of i){console.log("adding: ",a);const c=document.createRange().createContextualFragment(a.outerHTML).firstChild;if(!c)throw new Error("could not create new element from: "+a.outerHTML);if(console.log(c),n.callbacks.beforeNodeAdded(c)){if(c.hasAttribute("href")||c.hasAttribute("src")){let h;const p=new Promise(y=>{h=y});c.addEventListener("load",function(){h(void 0)}),d.push(p)}t.appendChild(c),n.callbacks.afterNodeAdded(c),s.push(c)}}for(const a of r)n.callbacks.beforeNodeRemoved(a)!==!1&&(t.removeChild(a),n.callbacks.afterNodeRemoved(a));return n.head.afterHeadMorphed(t,{added:s,kept:o,removed:r}),d}function M(){}function Lt(e,t,n){return{target:e,newContent:t,config:n,morphStyle:n.morphStyle,ignoreActive:n.ignoreActive,idMap:Ft(e,t),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:M,afterNodeAdded:M,beforeNodeMorphed:M,afterNodeMorphed:M,beforeNodeRemoved:M,afterNodeRemoved:M},n.callbacks),head:Object.assign({style:"merge",shouldPreserve:s=>s.getAttribute("im-preserve")==="true",shouldReAppend:s=>s.getAttribute("im-re-append")==="true",shouldRemove:M,afterHeadMorphed:M},n.head)}}function we(e,t,n){return!e||!t?!1:e.nodeType===t.nodeType&&e.tagName===t.tagName?e?.id?.length&&e.id===t.id?!0:H(n,e,t)>0:!1}function j(e,t){return!e||!t?!1:e.nodeType===t.nodeType&&e.tagName===t.tagName}function ve(e,t,n){for(;e!==t;){const s=e;if(e=e?.nextSibling,!s)throw new Error("tempNode is null");ye(s,n)}return L(n,t),t.nextSibling}function kt(e,t,n,s,r){const o=H(r,n,t);let i=null;if(o>0){i=s;let l=0;for(;i!=null;){if(we(n,i,r))return i;if(l+=H(r,i,e),l>o)return null;i=i.nextSibling}}return i}function Nt(e,t,n,s){let r=n,o=t.nextSibling,i=0;for(;r&&o;){if(H(s,r,e)>0)return null;if(j(t,r))return r;if(j(o,r)&&(i++,o=o.nextSibling,i>=2))return null;r=r.nextSibling}return r}const be=new DOMParser;function Rt(e){const t=e.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(t.match(/<\/html>/)||t.match(/<\/head>/)||t.match(/<\/body>/)){const n=be.parseFromString(e,"text/html");if(t.match(/<\/html>/))return z.add(n),n;{let s=n.firstChild;return s?(z.add(s),s):null}}else{const s=be.parseFromString(`<body><template>${e}</template></body>`,"text/html").body.querySelector("template")?.content;if(!s)throw new Error("content is null");return z.add(s),s}}function Ot(e){if(e==null)return document.createElement("div");if(z.has(e))return e;if(e instanceof Node){const t=document.createElement("div");return t.append(e),t}else{const t=document.createElement("div");for(const n of[...e])t.append(n);return t}}function Ct(e,t,n){const s=[],r=[];for(;e;)s.push(e),e=e.previousSibling;for(;s.length>0;){const o=s.pop();r.push(o),t?.parentElement?.insertBefore(o,t)}for(r.push(t);n;)s.push(n),r.push(n),n=n.nextSibling;for(;s.length;)t?.parentElement?.insertBefore(s.pop(),t.nextSibling);return r}function It(e,t,n){let s=e.firstChild,r=s,o=0;for(;s;){let i=$t(s,t,n);i>o&&(r=s,o=i),s=s.nextSibling}return r}function $t(e,t,n){return j(e,t)?.5+H(n,e,t):0}function ye(e,t){L(t,e),t.callbacks.beforeNodeRemoved(e)!==!1&&(e.remove(),t.callbacks.afterNodeRemoved(e))}function Ht(e,t){return!e.deadIds.has(t)}function qt(e,t,n){return e.idMap.get(n)?.has(t)||!1}function L(e,t){const n=e.idMap.get(t);if(n)for(const s of n)e.deadIds.add(s)}function H(e,t,n){const s=e.idMap.get(t);if(!s)return 0;let r=0;for(const o of s)Ht(e,o)&&qt(e,o,n)&&++r;return r}function Se(e,t){const n=e.parentElement,s=e.querySelectorAll("[id]");for(const r of s){let o=r;for(;o!==n&&o;){let i=t.get(o);i==null&&(i=new Set,t.set(o,i)),i.add(r.id),o=o.parentElement}}}function Ft(e,t){const n=new Map;return Se(e,n),Se(t,n),n}const _t=new DOMParser,Te="datastar",ee=`${Te}-indicator`,V=`${Te}-request`,Gt="Accept",Pe="text/html",zt="Content-Type",Bt="application/json",Ut="selector",jt="swap",te="get",Me=()=>q(te),Ae="post",De=()=>q(Ae),Le="put",ke=()=>q(Le),Ne="patch",Re=()=>q(Ne),Oe="delete",Ce=()=>q(Oe),Ie=()=>{Me(),De(),ke(),Re(),Ce()};let $e=!1;function q(e){if(!$e){const t=document.createElement("style");t.innerHTML=`
.${ee}{
  opacity:0;
  transition: opacity 500ms ease-in;
}
.${V} .${ee}{
    opacity:1
}
.${V}.${ee}{
    opacity:1
}
    `,document.head.appendChild(t),$e=!0}St({name:e,description:`turns @${e}(args) into fetch(${e}, args)`,fn:async t=>Vt(e,t)})}async function Vt(e,t){const{el:n,dataStack:s}=t,r=s.signals?.[e];if(!r)throw new Error(`No signal for ${e}`);const o=$(n);if(!o)throw new Error("Element must be an HTMLElement or SVGElement");o.classList.add(V);const i=new URL(r.value,window.location.origin),l=new Headers;if(l.append(Gt,Pe),l.append(zt,Bt),s?.headers)for(let h in s.headers){const p=s.headers[h];l.append(h,p.value)}const f=JSON.stringify(s,(h,p)=>p instanceof le?p.isEffect?void 0:p.get():p),d={method:e,headers:l};if(e===te){const h=new URLSearchParams(i.search);h.append("dataStack",f),i.search=h.toString()}else d.body=f;const a=await fetch(i,d);if(!a.ok)throw new Error("Network response was not ok.");const c=await a.text();He(o,c),o.classList.remove(V)}function He(e,t){const n=[..._t.parseFromString(t,Pe).body.children];for(let s=0;s<n.length;s++){const r=n[s];if(!(r instanceof Element))throw new Error("Not an element");const o=$(r),i=r.getAttribute("id"),l=s===0,f=!!i?.length,d=l&&!f;let a;if(d)a=[e];else{if(!f)throw new Error("No id");const c=o?.dataset?.[Ut]||`#${i}`;a=document.querySelectorAll(c)||[]}if(!a)throw new Error("No target element");for(const c of a){switch(o?.dataset?.[jt]||"morph"){case"morph":At(c,r);break;case"inner":c.innerHTML=r.innerHTML;break;case"outer":c.outerHTML=r.outerHTML;break;case"prepend":c.prepend(r.outerHTML);break;case"append":c.append(r.outerHTML);break;case"before":c.before(r);break;case"after":c.after(r);break;case"delete":c.remove();break;default:throw new Error("Invalid merge mode")}wt(c)}}}const Wt="model",qe=["change","input","keydown"];function Zt(){v(Wt,{allowedTags:["input","textarea","select"],requiredPlugins:[b],withExpression:({name:e,el:t,expression:n,dataStack:s,reactivity:{effect:r,onCleanup:o}})=>{const i=s.signals[n];if(!i)throw new Error(`Signal ${n} not found`);if(!("value"in t))throw new Error("Element must have a value property");t.value=i.value;const l=()=>{const f=i.value;if(typeof f=="number")i.value=Number(t.value);else if(typeof f=="string")i.value=t.value;else if(typeof f=="boolean")i.value=!!t.value;else throw new Error("Unsupported type")};return{model:{[`${e}-${Pt()}`]:r(()=>{t.value=i.value;for(const f of qe)t.addEventListener(f,l);o(()=>{for(const f of qe)t.removeEventListener(f,l)})})}}}})}const Fe="on",_e="once",Ge="throttle",ze="debounce",Be="leading";function Ue(){v(Fe,{requiredPlugins:[b],allowedModifiers:[_e,Ge,ze,Be],withExpression:({el:e,name:t,hasMod:n,withMod:s,expression:r,dataStack:o,reactivity:{computed:i,effect:l,onCleanup:f},actions:d})=>{const a=T(r),c=n(_e),h=s(Ge),p=s(ze),y=n(Be);if(t==="load"){document.addEventListener("DOMContentLoaded",()=>a(e,o,d),!0);return}const A=()=>a(e,o,d);let k=A,N;if(c)k=()=>{A(),N&&e.removeEventListener(t,N)};else if(h){const[D]=h.args,w=D?Number(D):1e3;let g=0;const R=i(()=>{const re=Date.now();if(re-g>=w)return g=re,A()});k=()=>R.value}else if(p){const[D]=p.args,w=D?Number(D):1e3;let g;const R=i(()=>{y&&!g&&A(),clearTimeout(g),g=setTimeout(()=>{y?g=void 0:A()},w)});k=()=>R.value}return N=()=>k(),e.addEventListener(t,N),{on:{[t]:l(()=>{f(()=>{c||e.removeEventListener(t,N)})})}}}})}const je="ref";function Ve(){v(je,{requiredPlugins:[b],preprocessExpressions:[{name:"ref",description:"turns #ref into data.refs.ref.value",regexp:new RegExp(/(?<whole>\#(?<ref>[a-zA-Z_$][0-9a-zA-Z_$]*))/g),replacer:({ref:e})=>`data.refs.${e}.value`}],withExpression:({el:e,name:t,reactivity:{signal:n}})=>({refs:{[t]:n(e)}})})}const ne="important",se="display",We="none",Ze="show";function Je(){v(Ze,{requiredPlugins:[b],allowedModifiers:[ne],withExpression:({el:e,name:t,dataStack:n,expression:s,hasMod:r,reactivity:{effect:o},actions:i})=>{const l=T(s);if(!(e instanceof HTMLElement||e instanceof SVGElement))throw new Error("Element must have a style property");const d=r(ne)?ne:void 0;return{show:{[t]:o(()=>{!!l(e,n,i)?e.style.length===1&&e.style.display===We?e.style.removeProperty(se):e.style.setProperty(se,"",d):e.style.setProperty(se,We,d)})}}}})}const b="signal",Xe="persist";function Ke(){v(b,{requiredPlugins:[x],preprocessExpressions:[{name:"signal",description:"turns $signal into dataStack.signals.signal.value",regexp:new RegExp(/(?<whole>\$(?<signal>[a-zA-Z_$][0-9a-zA-Z_$]*))/g),replacer:({signal:e})=>`dataStack.${b}s.${e}.value`}],allowedModifiers:[Xe],withExpression:({name:e,el:t,expression:n,reactivity:s,hasMod:r,actions:o})=>{const i=s.signal(oe(t,{},o,n));if(r(Xe)){const l=localStorage.getItem(e);if(l){const f=JSON.parse(l);i.value=f}s.effect(()=>{const f=JSON.stringify(i.value);localStorage.setItem(e,f)})}return{signals:{[e]:i}}}})}const Ye="prepend",Qe="append",xe="Target element must have a parent if using prepend or append",et="teleport";function tt(){v(et,{requiredPlugins:[b],allowedModifiers:[Ye,Qe],withExpression:({name:e,el:t,expression:n,dataStack:s,reactivity:{effect:r},hasMod:o,actions:i})=>{if(!(t instanceof HTMLTemplateElement))throw new Error("Element must be a template");const l=T(n);return{text:{[e]:r(()=>{const d=l(t,s,i);if(typeof d!="string")throw new Error("Selector must be a string");const a=document.querySelector(d);if(!a)throw new Error(`Target element not found: ${d}`);if(!t.content)throw new Error("Template element must have content");const c=t.content.cloneNode(!0);if($(c)?.firstElementChild)throw new Error("Empty template");if(o(Ye)){if(!a.parentNode)throw new Error(xe);a.parentNode.insertBefore(c,a)}else if(o(Qe)){if(!a.parentNode)throw new Error(xe);a.parentNode.insertBefore(c,a.nextSibling)}else a.appendChild(c);a.appendChild(c)})}}}})}const nt="text";function st(){v(nt,{withExpression:({name:e,el:t,expression:n,dataStack:s,actions:r,reactivity:{effect:o}})=>{const i=T(n);return{text:{[e]:o(()=>{if(!s?.signals)return;const f=i(t,s,r);t.textContent=`${f}`})}}}})}const rt="once",ot="full",it="half",at="intersects";function Jt(){v(at,{requiredPlugins:[b],allowedModifiers:[rt,ot,it],withExpression:({name:e,el:t,expression:n,dataStack:s,actions:r,hasMod:o,reactivity:{effect:i,onCleanup:l}})=>{const f=T(n),d=()=>f(t,s,r),a={threshold:0};o(ot)?a.threshold=1:o(it)&&(a.threshold=.5);const c=new IntersectionObserver(p=>{p.forEach(y=>{y.isIntersecting&&(d(),o(rt)&&c.disconnect())})},a);return{on:{[e]:i(()=>{c.observe(t),l(()=>{c.disconnect()})})}}}})}function Xt(){Mt(),Ke(),de(),Zt(),pe(),Ie(),Ue(),Ve(),Je(),tt(),st()}u.BIND=fe,u.DELETE=Oe,u.FOCUS=he,u.GET=te,u.INTERSECTS=at,u.ON=Fe,u.PATCH=Ne,u.POST=Ae,u.PUT=Le,u.REF=je,u.SHOW=Ze,u.SIGNAL=b,u.TELEPORT=et,u.TEXT=nt,u.addAllFragmentPlugins=Ie,u.addAllIncludedPlugins=Xt,u.addBindDataPlugin=de,u.addDeletePlugin=Ce,u.addFocusDataPlugin=pe,u.addGetPlugin=Me,u.addIntersectsPlugin=Jt,u.addOnDataPlugin=Ue,u.addPatchPlugin=Re,u.addPostPlugin=De,u.addPutPlugin=ke,u.addRefDataPlugin=Ve,u.addShowDataPlugin=Je,u.addSignalDataPlugin=Ke,u.addTeleportDataPlugin=tt,u.addTextDataPlugin=st,u.camelize=ie,u.functionEval=oe,u.functionGenerator=T,u.injectMockFetch=ct,u.mergeHTMLFragments=He,u.walkDownDOM=S,u.walkUpDOM=W,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=datastar.umd.cjs.map
